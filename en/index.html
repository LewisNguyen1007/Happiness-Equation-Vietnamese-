<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Explorer: The Instantaneous Happiness Equation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony (#fdfbf7, #a2bce0, #333333, #d4af37) -->
    <!-- Application Structure Plan: A single-page interactive web application with four key sections: 1) An introduction to the core equation, 2) An interactive emotional "pulse" explorer for users to adjust parameters (IAD, AG, SP, RM) and see a real-time updated chart, 3) A superposition simulator to visualize the cumulative effect of multiple emotional events, and 4) A structured explanation of the underlying theory. This structure was chosen to guide the user from high-level concept to interactive learning and then to theoretical depth, which is a more engaging approach for exploring a complex scientific model than a linear report format. -->
    <!-- Visualization & Content Choices: 1. Core Equation: Textual presentation. Goal: Inform. 2. Interactive Pulse: Chart.js line graph with sliders. Goal: Explore & Compare. Interaction: Sliders for four parameters update the chart and key metrics (peak height/time). Rationale: Direct manipulation is the most effective way to understand each variable's function. 3. Superposition Simulation: Chart.js line graph with event buttons. Goal: See change over time. Interaction: Buttons to add positive/negative events, comparing high and low regulation parameters. Rationale: Illustrates the cumulative, long-term impact of emotional regulation strategies. 4. Theory Section: HTML/Tailwind cards. Goal: Organize & Inform. Interaction: Simple layout, no complex interaction needed. Rationale: Breaks down dense text. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Lora', serif; background-color: #fdfbf7; color: #3a3a3a; }
        h1, h2, h3, .font-roboto { font-family: 'Roboto', sans-serif; }
        .katex-display { margin: 1em 0; overflow: auto; }
        .katex { font-size: 1.1em; }
        .param-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #a2bce0; cursor: pointer; border-radius: 50%; }
        .param-slider::-moz-range-thumb { width: 20px; height: 20px; background: #a2bce0; cursor: pointer; border-radius: 50%; }
        .chart-container { position: relative; width: 100%; max-width: 900px; margin-left: auto; margin-right: auto; height: 400px; max-height: 50vh; }
        .nav-link { transition: all 0.3s; }
        .nav-link:hover, .nav-link.active { color: #a2bce0; border-color: #a2bce0; }
    </style>
</head>
<body class="bg-[#fdfbf7]">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="text-xl font-bold font-roboto">The Happiness Equation</div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#intro" class="nav-link text-gray-700 border-b-2 border-transparent">Introduction</a>
                    <a href="#explorer" class="nav-link text-gray-700 border-b-2 border-transparent">Pulse Explorer</a>
                    <a href="#superposition" class="nav-link text-gray-700 border-b-2 border-transparent">Simulation</a>
                    <a href="#theory" class="nav-link text-gray-700 border-b-2 border-transparent">Theory</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <!-- Section 1: Introduction -->
        <section id="intro" class="text-center py-16 md:py-24">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 tracking-tight">Modeling Emotional Dynamics</h1>
            <p class="max-w-3xl mx-auto text-lg md:text-xl text-gray-600 mb-8">
                This theory proposes that our emotional experience is not a continuous stream, but the sum of countless instantaneous "pulses" of happiness or suffering. Each pulse is shaped by a nuanced mathematical equation.
            </p>
            <div class="bg-white rounded-lg shadow-lg p-6 max-w-4xl mx-auto text-left text-lg katex-container">
                <h3 class="font-roboto font-bold text-xl mb-4 text-center">The Instantaneous Happiness Equation for a Single 'Pulse'</h3>
                <p class="text-center text-gray-700 mb-4">For the <strong>n</strong>-th emotional event occurring at time <strong>t<sub>n</sub></strong>:</p>
                <div class="text-2xl text-center overflow-x-auto p-4">
                    H<sub>n</sub>(t) = IAD<sub>0,n</sub> AG<sub>n</sub> cos( &pi;/2 &sdot; SP<sub>n</sub> / (SP<sub>n</sub>+1) ) &sdot; s(t - t<sub>n</sub>; K<sub>n</sub>)
                </div>
            </div>
        </section>

        <!-- Section 2: Interactive Explorer -->
        <section id="explorer" class="py-16 md:py-24 bg-white rounded-2xl shadow-xl p-4 md:p-12 my-12">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">Explore an Emotional Pulse</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">
                Every emotion rises and falls in a distinct shape. Use the sliders below to adjust the parameters and see how a single emotional 'pulse' changes in real-time.
            </p>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                <div class="lg:col-span-2">
                    <div class="chart-container">
                        <canvas id="pulseChart"></canvas>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8 text-center">
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <h4 class="font-roboto font-bold text-gray-700">Time to Peak (τ<sub>peak</sub>)</h4>
                            <p id="peakTimeValue" class="text-2xl font-bold text-[#a2bce0]">0.62s</p>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <h4 class="font-roboto font-bold text-gray-700">Peak Intensity (H<sub>max</sub>)</h4>
                            <p id="peakHeightValue" class="text-2xl font-bold text-[#a2bce0]">1.03</p>
                        </div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div>
                        <label for="iadSlider" class="font-roboto font-bold block mb-1">IAD₀ (Initial Appraisal Discrepancy)</label>
                        <p class="text-sm text-gray-500 mb-2">The gap between 'what is' and 'what ought to be'. Determines if the emotion is positive or negative and its initial strength.</p>
                        <input id="iadSlider" type="range" min="-10" max="10" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider">
                        <div class="text-center font-roboto" id="iadValue">5.0</div>
                    </div>
                    <div>
                        <label for="agSlider" class="font-roboto font-bold block mb-1">AG (Amplification Gain)</label>
                        <p class="text-sm text-gray-500 mb-2">Individual emotional sensitivity. High AG intensifies all emotions.</p>
                        <input id="agSlider" type="range" min="0.1" max="2" value="1" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider">
                        <div class="text-center font-roboto" id="agValue">1.0</div>
                    </div>
                    <div>
                        <label for="spSlider" class="font-roboto font-bold block mb-1">SP (Samatha Proficiency)</label>
                        <p class="text-sm text-gray-500 mb-2">The ability to stabilize the mind, which 'compresses' emotional intensity (less intense highs, less deep lows).</p>
                        <input id="spSlider" type="range" min="0" max="10" value="1" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider">
                        <div class="text-center font-roboto" id="spValue">1.0</div>
                    </div>
                    <div>
                        <label for="rmSlider" class="font-roboto font-bold block mb-1">RM (Reappraisal Mastery)</label>
                        <p class="text-sm text-gray-500 mb-2">The ability to re-interpret events, which prolongs positive emotions and shortens negative ones.</p>
                        <input id="rmSlider" type="range" min="0.5" max="5" value="1" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider">
                        <div class="text-center font-roboto" id="rmValue">1.0</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Superposition Simulation -->
        <section id="superposition" class="py-16 md:py-24">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">Superposition of Moments</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">
                Life is a series of events. Our total emotional state at any moment is the sum of all ongoing emotional 'pulses'. Try creating events and see how the emotional curve changes.
            </p>
            <div class="bg-white rounded-2xl shadow-xl p-4 md:p-12">
                 <div class="chart-container" style="height: 450px;">
                    <canvas id="superpositionChart"></canvas>
                </div>
                <div class="flex flex-wrap justify-center items-center gap-4 mt-8">
                    <button id="addPositiveEvent" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        + Add Positive Event
                    </button>
                    <button id="addNegativeEvent" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        - Add Negative Event
                    </button>
                     <button id="resetSimulation" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        ↻ Reset
                    </button>
                </div>
                 <div class="mt-8 p-4 bg-gray-100 rounded-lg text-center">
                    <p class="text-gray-700">Compare a <strong class="text-green-600">Trained Mind</strong> (high SP & RM) with a <strong class="text-purple-600">Reactive Mind</strong> (low SP & RM).</p>
                    <p class="text-sm text-gray-500">Uses the parameters selected above for the Trained Mind.</p>
                </div>
            </div>
        </section>

        <!-- Section 4: Theory -->
        <section id="theory" class="py-16 md:py-24">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">Theoretical Basis</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">
                This equation is not arbitrary. It is derived from a detailed model of cognitive processing and fundamental physiological principles.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="font-roboto text-2xl font-bold mb-4">Three Physiological Forces</h3>
                    <p class="mb-4">The shape of an emotional pulse results from a dynamic balance between three physiological forces:</p>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="text-2xl text-green-500 mr-4">&#x2197;</span>
                            <div>
                                <h4 class="font-bold">Early Amplification</h4>
                                <p class="text-gray-600">The initial orienting response and excitement from a new stimulus.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl text-yellow-500 mr-4">&#x2198;</span>
                            <div>
                                <h4 class="font-bold">Saturation & Adaptation</h4>
                                <p class="text-gray-600">A "braking" mechanism that prevents system overload and habituates to the stimulus.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                             <span class="text-2xl text-red-500 mr-4">&#x2193;</span>
                            <div>
                                <h4 class="font-bold">Homeostatic Elimination</h4>
                                <p class="text-gray-600">The process of returning the system to its original baseline equilibrium.</p>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="font-roboto text-2xl font-bold mb-4">"The Dynamic Loop" & "The Operational Self"</h3>
                    <p class="mb-4">The equation's parameters are anchored in a detailed cognitive theory:</p>
                     <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="text-xl mr-4">🎯</span>
                            <div>
                                <h4 class="font-bold">IAD₀ (Discrepancy)</h4>
                                <p class="text-gray-600">Born from the comparison between "IS" and "OUGHT" states in the Operational Self.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-xl mr-4">🧘</span>
                            <div>
                                <h4 class="font-bold">SP (Samatha)</h4>
                                <p class="text-gray-600">The ability to stabilize "Attention" (Stage 3 of the Dynamic Loop), which compresses amplitude.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-xl mr-4">💡</span>
                            <div>
                                <h4 class="font-bold">RM (Vipassanā/Reappraisal)</h4>
                                <p class="text-gray-600">The ability to navigate the "Cognitive Fork" (Stage 7), which shapes duration.</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="text-center py-8 border-t">
        <p class="text-gray-500">An interactive explorer based on the theory of Instantaneous Emotional Dynamics.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sliders = {
                iad: document.getElementById('iadSlider'),
                ag: document.getElementById('agSlider'),
                sp: document.getElementById('spSlider'),
                rm: document.getElementById('rmSlider')
            };

            const values = {
                iad: document.getElementById('iadValue'),
                ag: document.getElementById('agValue'),
                sp: document.getElementById('spValue'),
                rm: document.getElementById('rmValue')
            };

            const peakTimeValue = document.getElementById('peakTimeValue');
            const peakHeightValue = document.getElementById('peakHeightValue');

            let pulseChart;

            // Shape function s(τ; K)
            function s(tau, K) {
                if (tau < 0 || K <= 0) return 0;
                // Represents the rise and fall of the emotional pulse
                return (tau / (tau + K)) * Math.exp(-tau / K);
            }
            
            // Full Happiness Pulse Equation Hn(t)
            function Hn(t, IAD0, AG, SP, RM) {
                const sign_IAD0 = IAD0 > 0 ? 1 : (IAD0 < 0 ? -1 : 0);
                // K is the time constant, affected by Reappraisal Mastery (RM)
                const K = Math.pow(RM, sign_IAD0);
                // Amplitude is affected by the initial appraisal, amplification, and Samatha Proficiency (SP)
                const amplitude = IAD0 * AG * Math.cos((Math.PI / 2) * (SP / (SP + 1)));
                return amplitude * s(t, K);
            }

            function updatePulseChart() {
                const IAD0 = parseFloat(sliders.iad.value);
                const AG = parseFloat(sliders.ag.value);
                const SP = parseFloat(sliders.sp.value);
                const RM = parseFloat(sliders.rm.value);
                
                values.iad.textContent = IAD0.toFixed(1);
                values.ag.textContent = AG.toFixed(1);
                values.sp.textContent = SP.toFixed(1);
                values.rm.textContent = RM.toFixed(1);

                const sign_IAD0 = IAD0 > 0 ? 1 : (IAD0 < 0 ? -1 : 0);
                const K = Math.pow(RM, sign_IAD0);
                
                // Generate data points for the chart
                const timePoints = Array.from({ length: 101 }, (_, i) => i * (10 * K) / 100);
                const data = timePoints.map(t => Hn(t, IAD0, AG, SP, RM));
                
                pulseChart.data.labels = timePoints;
                pulseChart.data.datasets[0].data = data;
                
                let peakTime = 0;
                let peakHeight = 0;
                if (IAD0 !== 0) {
                     // The peak of the s(t) function occurs at t = φ*K, where φ is the golden ratio conjugate
                     peakTime = ((Math.sqrt(5) - 1) / 2) * K;
                     const amplitude = IAD0 * AG * Math.cos((Math.PI / 2) * (SP / (SP + 1)));
                     // Maximum value of s(t)
                     const phi = (1 + Math.sqrt(5)) / 2;
                     const s_max = (1 / (phi*phi)) * Math.exp(-1/phi);
                     peakHeight = amplitude * s_max;
                }
                
                peakTimeValue.textContent = `${peakTime.toFixed(2)}s`;
                peakHeightValue.textContent = peakHeight.toFixed(2);
                
                // No longer need to dynamically set axis max, it's fixed in options
                pulseChart.update();
            }

            function createPulseChart() {
                const ctx = document.getElementById('pulseChart').getContext('2d');
                pulseChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Emotional Intensity (Hn)',
                            data: [],
                            borderColor: '#a2bce0',
                            backgroundColor: 'rgba(162, 188, 224, 0.2)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'linear',
                                title: { display: true, text: 'Time (seconds)' },
                                min: 0,
                                max: 7 // Fixed X-axis range
                            },
                            y: {
                                title: { display: true, text: 'Happiness (+/-)' },
                                grid: { color: '#e0e0e0' },
                                min: -3, // Fixed Y-axis range
                                max: 3   // Fixed Y-axis range
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        animation: {
                            duration: 0
                        }
                    }
                });
                updatePulseChart();
            }

            Object.values(sliders).forEach(slider => {
                slider.addEventListener('input', updatePulseChart);
            });

            createPulseChart();
            
            // Superposition Chart Logic
            let superpositionChart;
            let events = []; // Array to store emotional events {time, IAD0}
            const simLength = 100; // Simulation timeline length
            const timeAxis = Array.from({length: simLength}, (_,i)=>i);

            function createSuperpositionChart() {
                const ctx = document.getElementById('superpositionChart').getContext('2d');
                superpositionChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timeAxis,
                        datasets: [
                        {
                            label: 'Trained Mind',
                            data: [],
                            borderColor: '#22c55e',
                            borderWidth: 3,
                            pointRadius: 0,
                            tension: 0.2,
                        },
                        {
                            label: 'Reactive Mind',
                            data: [],
                            borderColor: '#a855f7',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            tension: 0.2,
                        }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'Timeline' } },
                            y: { title: { display: true, text: 'Aggregate Emotion' }, suggestedMin: -10, suggestedMax: 10}
                        },
                        plugins: { legend: { position: 'top' } }
                    }
                });
            }

            function updateSuperpositionChart() {
                const trainedMindData = new Array(simLength).fill(0);
                const reactiveMindData = new Array(simLength).fill(0);

                // Parameters for the two mind types
                const trainedParams = {
                    AG: parseFloat(sliders.ag.value),
                    SP: parseFloat(sliders.sp.value),
                    RM: parseFloat(sliders.rm.value)
                };
                const reactiveParams = { AG: 1.5, SP: 0.1, RM: 1 }; // Fixed params for a reactive mind

                // For each event, add its emotional pulse to the aggregate data
                events.forEach(event => {
                    for(let t = 0; t < simLength; t++){
                        const tau = t - event.time; // time since event
                        if(tau >= 0) {
                            trainedMindData[t] += Hn(tau, event.IAD0, trainedParams.AG, trainedParams.SP, trainedParams.RM);
                            reactiveMindData[t] += Hn(tau, event.IAD0, reactiveParams.AG, reactiveParams.SP, reactiveParams.RM);
                        }
                    }
                });
                
                superpositionChart.data.datasets[0].data = trainedMindData;
                superpositionChart.data.datasets[1].data = reactiveMindData;
                superpositionChart.update();
            }

            document.getElementById('addPositiveEvent').addEventListener('click', () => {
                events.push({time: Math.random()* (simLength-10), IAD0: 5 + Math.random() * 5 });
                updateSuperpositionChart();
            });

            document.getElementById('addNegativeEvent').addEventListener('click', () => {
                events.push({time: Math.random()* (simLength-10), IAD0: -5 - Math.random() * 5 });
                updateSuperpositionChart();
            });
            
            document.getElementById('resetSimulation').addEventListener('click', () => {
                events = [];
                updateSuperpositionChart();
            });
            
            createSuperpositionChart();
            updateSuperpositionChart();

            // Nav link active state on scroll
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 100) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            });
        });
    </script>
</body>
</html>

