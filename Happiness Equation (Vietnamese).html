<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kh√°m Ph√° T∆∞∆°ng T√°c: Ph∆∞∆°ng Tr√¨nh H·∫°nh Ph√∫c T·ª©c Th·ªùi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony (#fdfbf7, #a2bce0, #333333, #d4af37) -->
    <!-- Application Structure Plan: M·ªôt ·ª©ng d·ª•ng web t∆∞∆°ng t√°c tr√™n m·ªôt trang duy nh·∫•t v·ªõi b·ªën ph·∫ßn ch√≠nh: 1) Gi·ªõi thi·ªáu ph∆∞∆°ng tr√¨nh c·ªët l√µi, 2) M·ªôt tr√¨nh kh√°m ph√° "xung" c·∫£m x√∫c t∆∞∆°ng t√°c ƒë·ªÉ ng∆∞·ªùi d√πng ƒëi·ªÅu ch·ªânh c√°c tham s·ªë (IAD, AG, SP, RM) v√† xem bi·ªÉu ƒë·ªì c·∫≠p nh·∫≠t theo th·ªùi gian th·ª±c, 3) M·ªôt tr√¨nh m√¥ ph·ªèng s·ª± ch·ªìng ch·∫≠p ƒë·ªÉ h√¨nh dung hi·ªáu ·ª©ng t√≠ch l≈©y c·ªßa nhi·ªÅu s·ª± ki·ªán c·∫£m x√∫c, v√† 4) M·ªôt ph·∫ßn gi·∫£i th√≠ch c√≥ c·∫•u tr√∫c v·ªÅ l√Ω thuy·∫øt n·ªÅn t·∫£ng. C·∫•u tr√∫c n√†y ƒë∆∞·ª£c ch·ªçn ƒë·ªÉ h∆∞·ªõng d·∫´n ng∆∞·ªùi d√πng t·ª´ kh√°i ni·ªám c·∫•p cao ƒë·∫øn vi·ªác h·ªçc h·ªèi t∆∞∆°ng t√°c v√† sau ƒë√≥ l√† chi·ªÅu s√¢u l√Ω thuy·∫øt, m·ªôt c√°ch ti·∫øp c·∫≠n h·∫•p d·∫´n h∆°n ƒë·ªÉ kh√°m ph√° m·ªôt m√¥ h√¨nh khoa h·ªçc ph·ª©c t·∫°p so v·ªõi ƒë·ªãnh d·∫°ng b√°o c√°o tuy·∫øn t√≠nh. -->
    <!-- Visualization & Content Choices: 1. Ph∆∞∆°ng tr√¨nh C·ªët l√µi: Tr√¨nh b√†y d·∫°ng vƒÉn b·∫£n. M·ª•c ti√™u: Th√¥ng b√°o. 2. Xung T∆∞∆°ng t√°c: Bi·ªÉu ƒë·ªì ƒë∆∞·ªùng Chart.js v·ªõi c√°c thanh tr∆∞·ª£t. M·ª•c ti√™u: Kh√°m ph√° & So s√°nh. T∆∞∆°ng t√°c: Thanh tr∆∞·ª£t cho b·ªën tham s·ªë c·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì v√† c√°c ch·ªâ s·ªë ch√≠nh (ƒë·ªô cao/th·ªùi gian ƒë·ªânh). L√Ω do: Thao t√°c tr·ª±c ti·∫øp l√† c√°ch hi·ªáu qu·∫£ nh·∫•t ƒë·ªÉ hi·ªÉu ch·ª©c nƒÉng c·ªßa m·ªói bi·∫øn. 3. M√¥ ph·ªèng Ch·ªìng ch·∫≠p: Bi·ªÉu ƒë·ªì ƒë∆∞·ªùng Chart.js v·ªõi c√°c n√∫t s·ª± ki·ªán. M·ª•c ti√™u: Xem s·ª± thay ƒë·ªïi theo th·ªùi gian. T∆∞∆°ng t√°c: C√°c n√∫t ƒë·ªÉ th√™m s·ª± ki·ªán t√≠ch c·ª±c/ti√™u c·ª±c, so s√°nh c√°c tham s·ªë ƒëi·ªÅu h√≤a cao v√† th·∫•p. L√Ω do: Minh h·ªça t√°c ƒë·ªông t√≠ch l≈©y, d√†i h·∫°n c·ªßa c√°c chi·∫øn l∆∞·ª£c ƒëi·ªÅu h√≤a c·∫£m x√∫c. 4. Ph·∫ßn L√Ω thuy·∫øt: C√°c th·∫ª HTML/Tailwind. M·ª•c ti√™u: T·ªï ch·ª©c & Th√¥ng b√°o. T∆∞∆°ng t√°c: B·ªë c·ª•c ƒë∆°n gi·∫£n, kh√¥ng c·∫ßn t∆∞∆°ng t√°c ph·ª©c t·∫°p. L√Ω do: Ph√¢n r√£ vƒÉn b·∫£n d√†y ƒë·∫∑c. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Lora', serif; background-color: #fdfbf7; color: #3a3a3a; }
        h1, h2, h3, .font-roboto { font-family: 'Roboto', sans-serif; }
        .katex-display { margin: 1em 0; overflow: auto; }
        .katex { font-size: 1.1em; }
        .param-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #a2bce0; cursor: pointer; border-radius: 50%; }
        .param-slider::-moz-range-thumb { width: 20px; height: 20px; background: #a2bce0; cursor: pointer; border-radius: 50%; }
        .chart-container { position: relative; width: 100%; max-width: 900px; margin-left: auto; margin-right: auto; height: 400px; max-height: 50vh; }
        .nav-link { transition: all 0.3s; }
        .nav-link:hover, .nav-link.active { color: #a2bce0; border-color: #a2bce0; }
    </style>
</head>
<body class="bg-[#fdfbf7]">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="text-xl font-bold font-roboto">Ph∆∞∆°ng Tr√¨nh H·∫°nh Ph√∫c</div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#intro" class="nav-link text-gray-700 border-b-2 border-transparent">Gi·ªõi Thi·ªáu</a>
                    <a href="#explorer" class="nav-link text-gray-700 border-b-2 border-transparent">Kh√°m Ph√° Xung</a>
                    <a href="#superposition" class="nav-link text-gray-700 border-b-2 border-transparent">M√¥ Ph·ªèng T·ªïng H·ª£p</a>
                    <a href="#theory" class="nav-link text-gray-700 border-b-2 border-transparent">N·ªÅn T·∫£ng L√Ω Thuy·∫øt</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <!-- Section 1: Introduction -->
        <section id="intro" class="text-center py-16 md:py-24">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 tracking-tight">M√¥ H√¨nh H√≥a ƒê·ªông H·ªçc C·∫£m X√∫c</h1>
            <p class="max-w-3xl mx-auto text-lg md:text-xl text-gray-600 mb-8">
                L√Ω thuy·∫øt n√†y ƒë·ªÅ xu·∫•t r·∫±ng tr·∫£i nghi·ªám c·∫£m x√∫c c·ªßa ch√∫ng ta kh√¥ng ph·∫£i l√† m·ªôt d√≤ng ch·∫£y li√™n t·ª•c, m√† l√† t·ªïng h·ª£p c·ªßa v√¥ s·ªë "xung" h·∫°nh ph√∫c ho·∫∑c kh·ªï ƒëau t·ª©c th·ªùi. M·ªói xung ƒë∆∞·ª£c ƒë·ªãnh h√¨nh b·ªüi m·ªôt ph∆∞∆°ng tr√¨nh to√°n h·ªçc tinh t·∫ø.
            </p>
            <div class="bg-white rounded-lg shadow-lg p-6 max-w-4xl mx-auto text-left text-lg katex-container">
                <h3 class="font-roboto font-bold text-xl mb-4 text-center">Ph∆∞∆°ng Tr√¨nh H·∫°nh Ph√∫c T·ª©c Th·ªùi cho m·ªôt "Xung"</h3>
                <p class="text-center text-gray-700 mb-4">ƒê·ªëi v·ªõi m·ªôt s·ª± ki·ªán c·∫£m x√∫c th·ª© <strong>n</strong> x·∫£y ra t·∫°i th·ªùi ƒëi·ªÉm <strong>t<sub>n</sub></strong>:</p>
                <div class="text-2xl text-center overflow-x-auto p-4">
                    H<sub>n</sub>(t) = IAD<sub>0,n</sub> AG<sub>n</sub> cos( &pi;/2 &sdot; SP<sub>n</sub> / (SP<sub>n</sub>+1) ) &sdot; s(t - t<sub>n</sub>; K<sub>n</sub>)
                </div>
            </div>
        </section>

        <!-- Section 2: Interactive Explorer -->
        <section id="explorer" class="py-16 md:py-24 bg-white rounded-2xl shadow-xl p-4 md:p-12 my-12">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">Kh√°m Ph√° m·ªôt Xung C·∫£m X√∫c</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">
                M·ªói c·∫£m x√∫c d√¢ng l√™n r·ªìi tan bi·∫øn theo m·ªôt h√¨nh d·∫°ng nh·∫•t ƒë·ªãnh. H√£y s·ª≠ d·ª•ng c√°c thanh tr∆∞·ª£t b√™n d∆∞·ªõi ƒë·ªÉ ƒëi·ªÅu ch·ªânh c√°c tham s·ªë v√† quan s√°t c√°ch m·ªôt "xung" c·∫£m x√∫c thay ƒë·ªïi theo th·ªùi gian th·ª±c.
            </p>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                <div class="lg:col-span-2">
                    <div class="chart-container">
                        <canvas id="pulseChart"></canvas>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-8 text-center">
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <h4 class="font-roboto font-bold text-gray-700">Th·ªùi Gian ƒê·∫°t ƒê·ªânh (œÑ<sub>peak</sub>)</h4>
                            <p id="peakTimeValue" class="text-2xl font-bold text-[#a2bce0]">0.62s</p>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <h4 class="font-roboto font-bold text-gray-700">C∆∞·ªùng ƒê·ªô C·ª±c ƒê·∫°i (H<sub>max</sub>)</h4>
                            <p id="peakHeightValue" class="text-2xl font-bold text-[#a2bce0]">1.03</p>
                        </div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div>
                        <label for="iadSlider" class="font-roboto font-bold block mb-1">IAD‚ÇÄ (ƒê·ªô ch√™nh th·∫©m ƒë·ªãnh ban ƒë·∫ßu)</label>
                        <p class="text-sm text-gray-500 mb-2">S·ª± ch√™nh l·ªách gi·ªØa "th·ª±c t·∫°i" v√† "mong ƒë·ª£i". Quy·∫øt ƒë·ªãnh c·∫£m x√∫c l√† t√≠ch c·ª±c hay ti√™u c·ª±c v√† c∆∞·ªùng ƒë·ªô ban ƒë·∫ßu.</p>
                        <input id="iadSlider" type="range" min="-10" max="10" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider">
                        <div class="text-center font-roboto" id="iadValue">5.0</div>
                    </div>
                    <div>
                        <label for="agSlider" class="font-roboto font-bold block mb-1">AG (H·ªá s·ªë khu·∫øch ƒë·∫°i)</label>
                        <p class="text-sm text-gray-500 mb-2">ƒê·ªô nh·∫°y c·∫£m x√∫c c√° nh√¢n. AG cao l√†m tƒÉng c∆∞·ªùng ƒë·ªô c·ªßa m·ªçi c·∫£m x√∫c.</p>
                        <input id="agSlider" type="range" min="0.1" max="2" value="1" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider">
                        <div class="text-center font-roboto" id="agValue">1.0</div>
                    </div>
                    <div>
                        <label for="spSlider" class="font-roboto font-bold block mb-1">SP (Thu·∫ßn th·ª•c Samatha)</label>
                        <p class="text-sm text-gray-500 mb-2">NƒÉng l·ª±c ƒë·ªãnh t√¢m, gi√∫p "gh√¨m" c∆∞·ªùng ƒë·ªô c·∫£m x√∫c l·∫°i ("vui b·ªõt b·ªëc, bu·ªìn b·ªõt s√¢u").</p>
                        <input id="spSlider" type="range" min="0" max="10" value="1" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider">
                        <div class="text-center font-roboto" id="spValue">1.0</div>
                    </div>
                    <div>
                        <label for="rmSlider" class="font-roboto font-bold block mb-1">RM (Tinh th√¥ng T√°i th·∫©m ƒë·ªãnh)</label>
                        <p class="text-sm text-gray-500 mb-2">NƒÉng l·ª±c t√°i di·ªÖn gi·∫£i, gi√∫p k√©o d√†i c·∫£m x√∫c t√≠ch c·ª±c v√† r√∫t ng·∫Øn c·∫£m x√∫c ti√™u c·ª±c.</p>
                        <input id="rmSlider" type="range" min="0.5" max="5" value="1" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer param-slider">
                        <div class="text-center font-roboto" id="rmValue">1.0</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Superposition Simulation -->
        <section id="superposition" class="py-16 md:py-24">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">T·ªïng H·ª£p C√°c Kho·∫£nh Kh·∫Øc</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">
                Cu·ªôc s·ªëng l√† m·ªôt chu·ªói c√°c s·ª± ki·ªán. C·∫£m x√∫c t·ªïng th·ªÉ c·ªßa ch√∫ng ta t·∫°i b·∫•t k·ª≥ th·ªùi ƒëi·ªÉm n√†o l√† t·ªïng h·ª£p c·ªßa t·∫•t c·∫£ c√°c "xung" c·∫£m x√∫c ƒëang di·ªÖn ra. H√£y th·ª≠ t·∫°o ra c√°c s·ª± ki·ªán v√† xem ƒë∆∞·ªùng cong c·∫£m x√∫c thay ƒë·ªïi nh∆∞ th·∫ø n√†o.
            </p>
            <div class="bg-white rounded-2xl shadow-xl p-4 md:p-12">
                 <div class="chart-container" style="height: 450px;">
                    <canvas id="superpositionChart"></canvas>
                </div>
                <div class="flex flex-wrap justify-center items-center gap-4 mt-8">
                    <button id="addPositiveEvent" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        + Th√™m S·ª± Ki·ªán T√≠ch C·ª±c
                    </button>
                    <button id="addNegativeEvent" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        - Th√™m S·ª± Ki·ªán Ti√™u C·ª±c
                    </button>
                     <button id="resetSimulation" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                        ‚Üª Thi·∫øt L·∫≠p L·∫°i
                    </button>
                </div>
                 <div class="mt-8 p-4 bg-gray-100 rounded-lg text-center">
                    <p class="text-gray-700">So s√°nh T√¢m tr√≠ <strong class="text-green-600">ƒê∆∞·ª£c R√®n Luy·ªán</strong> (SP & RM cao) v·ªõi T√¢m tr√≠ <strong class="text-purple-600">Ph·∫£n ·ª®ng</strong> (SP & RM th·∫•p).</p>
                    <p class="text-sm text-gray-500">S·ª≠ d·ª•ng c√°c tham s·ªë ƒë√£ ch·ªçn ·ªü tr√™n cho T√¢m tr√≠ ƒê∆∞·ª£c R√®n Luy·ªán.</p>
                </div>
            </div>
        </section>

        <!-- Section 4: Theory -->
        <section id="theory" class="py-16 md:py-24">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">N·ªÅn T·∫£ng L√Ω Thuy·∫øt</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">
                Ph∆∞∆°ng tr√¨nh n√†y kh√¥ng ph·∫£i l√† ng·∫´u nhi√™n. N√≥ ƒë∆∞·ª£c suy ra t·ª´ m·ªôt m√¥ h√¨nh chi ti·∫øt v·ªÅ c√°ch t√¢m tr√≠ x·ª≠ l√Ω th√¥ng tin v√† c√°c nguy√™n l√Ω sinh l√Ω c∆° b·∫£n.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="font-roboto text-2xl font-bold mb-4">Ba L·ª±c L∆∞·ª£ng Sinh L√Ω</h3>
                    <p class="mb-4">H√¨nh d·∫°ng c·ªßa m·ªôt xung c·∫£m x√∫c l√† k·∫øt qu·∫£ c·ªßa s·ª± c√¢n b·∫±ng ƒë·ªông gi·ªØa ba l·ª±c l∆∞·ª£ng sinh l√Ω:</p>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="text-2xl text-green-500 mr-4">&#x2197;</span>
                            <div>
                                <h4 class="font-bold">Khu·∫øch ƒë·∫°i S·ªõm</h4>
                                <p class="text-gray-600">Ph·∫£n ·ª©ng ƒë·ªãnh h∆∞·ªõng, h·ª©ng kh·ªüi ban ƒë·∫ßu khi c√≥ m·ªôt k√≠ch th√≠ch m·ªõi.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl text-yellow-500 mr-4">&#x2198;</span>
                            <div>
                                <h4 class="font-bold">B√£o h√≤a & Th√≠ch nghi</h4>
                                <p class="text-gray-600">C∆° ch·∫ø "phanh" gi√∫p h·ªá th·ªëng kh√¥ng b·ªã qu√° t·∫£i, d·∫ßn quen v·ªõi k√≠ch th√≠ch.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                             <span class="text-2xl text-red-500 mr-4">&#x2193;</span>
                            <div>
                                <h4 class="font-bold">ƒê√†o th·∫£i C√¢n b·∫±ng</h4>
                                <p class="text-gray-600">Qu√° tr√¨nh ƒë∆∞a h·ªá th·ªëng tr·ªü l·∫°i tr·∫°ng th√°i c√¢n b·∫±ng n·ªôi m√¥i ban ƒë·∫ßu.</p>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="font-roboto text-2xl font-bold mb-4">"V√≤ng L·∫∑p ƒê·ªông" & "C√°i T√¥i V·∫≠n H√†nh"</h3>
                    <p class="mb-4">C√°c tham s·ªë c·ªßa ph∆∞∆°ng tr√¨nh ƒë∆∞·ª£c neo gi·ªØ v√†o m·ªôt l√Ω thuy·∫øt nh·∫≠n th·ª©c chi ti·∫øt:</p>
                     <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="text-xl mr-4">üéØ</span>
                            <div>
                                <h4 class="font-bold">IAD‚ÇÄ (ƒê·ªô ch√™nh)</h4>
                                <p class="text-gray-600">Sinh ra t·ª´ s·ª± so s√°nh gi·ªØa "Th·ª±c t·∫°i" (IS) v√† "Gi√° tr·ªã" (OUGHT) c·ªßa "C√°i T√¥i V·∫≠n H√†nh".</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-xl mr-4">üßò</span>
                            <div>
                                <h4 class="font-bold">SP (Samatha)</h4>
                                <p class="text-gray-600">L√† nƒÉng l·ª±c ·ªïn ƒë·ªãnh "Ch√∫ √Ω" (Giai ƒëo·∫°n 3 c·ªßa V√≤ng L·∫∑p ƒê·ªông), gi√∫p n√©n bi√™n ƒë·ªô.</p>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-xl mr-4">üí°</span>
                            <div>
                                <h4 class="font-bold">RM (VipassanƒÅ)</h4>
                                <p class="text-gray-600">L√† nƒÉng l·ª±c ƒëi·ªÅu h∆∞·ªõng "Ng√£ ba T∆∞ duy" (Giai ƒëo·∫°n 7), gi√∫p ƒë·ªãnh h√¨nh th·ªùi gian.</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="text-center py-8 border-t">
        <p class="text-gray-500">M·ªôt ·ª©ng d·ª•ng t∆∞∆°ng t√°c d·ª±a tr√™n l√Ω thuy·∫øt v·ªÅ ƒê·ªông h·ªçc C·∫£m x√∫c T·ª©c th·ªùi.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sliders = {
                iad: document.getElementById('iadSlider'),
                ag: document.getElementById('agSlider'),
                sp: document.getElementById('spSlider'),
                rm: document.getElementById('rmSlider')
            };

            const values = {
                iad: document.getElementById('iadValue'),
                ag: document.getElementById('agValue'),
                sp: document.getElementById('spValue'),
                rm: document.getElementById('rmValue')
            };

            const peakTimeValue = document.getElementById('peakTimeValue');
            const peakHeightValue = document.getElementById('peakHeightValue');

            let pulseChart;

            function s(tau, K) {
                if (tau < 0 || K <= 0) return 0;
                return (tau / (tau + K)) * Math.exp(-tau / K);
            }
            
            function Hn(t, IAD0, AG, SP, RM) {
                const sign_IAD0 = IAD0 > 0 ? 1 : (IAD0 < 0 ? -1 : 0);
                const K = Math.pow(RM, sign_IAD0);
                const amplitude = IAD0 * AG * Math.cos((Math.PI / 2) * (SP / (SP + 1)));
                return amplitude * s(t, K);
            }

            function updatePulseChart() {
                const IAD0 = parseFloat(sliders.iad.value);
                const AG = parseFloat(sliders.ag.value);
                const SP = parseFloat(sliders.sp.value);
                const RM = parseFloat(sliders.rm.value);
                
                values.iad.textContent = IAD0.toFixed(1);
                values.ag.textContent = AG.toFixed(1);
                values.sp.textContent = SP.toFixed(1);
                values.rm.textContent = RM.toFixed(1);

                const sign_IAD0 = IAD0 > 0 ? 1 : (IAD0 < 0 ? -1 : 0);
                const K = Math.pow(RM, sign_IAD0);
                
                const timePoints = Array.from({ length: 101 }, (_, i) => i * (10 * K) / 100);
                const data = timePoints.map(t => Hn(t, IAD0, AG, SP, RM));
                
                pulseChart.data.labels = timePoints;
                pulseChart.data.datasets[0].data = data;
                
                let peakTime = 0;
                let peakHeight = 0;
                if (IAD0 !== 0) {
                     peakTime = ((Math.sqrt(5) - 1) / 2) * K;
                     const amplitude = IAD0 * AG * Math.cos((Math.PI / 2) * (SP / (SP + 1)));
                     const phi = (1 + Math.sqrt(5)) / 2;
                     const s_max = (1 / (phi*phi)) * Math.exp(-1/phi);
                     peakHeight = amplitude * s_max;
                }
                
                peakTimeValue.textContent = `${peakTime.toFixed(2)}s`;
                peakHeightValue.textContent = peakHeight.toFixed(2);
                
                pulseChart.update();
            }

            function createPulseChart() {
                const ctx = document.getElementById('pulseChart').getContext('2d');
                pulseChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'C∆∞·ªùng ƒê·ªô C·∫£m X√∫c (Hn)',
                            data: [],
                            borderColor: '#a2bce0',
                            backgroundColor: 'rgba(162, 188, 224, 0.2)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'linear',
                                title: { display: true, text: 'Th·ªùi gian (gi√¢y)' },
                                min: 0,
                                max: 7
                            },
                            y: {
                                title: { display: true, text: 'H·∫°nh ph√∫c (+/-)' },
                                grid: { color: '#e0e0e0' },
                                min: -3,
                                max: 3
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        animation: {
                            duration: 0
                        }
                    }
                });
                updatePulseChart();
            }

            Object.values(sliders).forEach(slider => {
                slider.addEventListener('input', updatePulseChart);
            });

            createPulseChart();
            
            // Superposition Chart Logic
            let superpositionChart;
            let events = [];
            const simLength = 100;
            const timeAxis = Array.from({length: simLength}, (_,i)=>i);

            function createSuperpositionChart() {
                const ctx = document.getElementById('superpositionChart').getContext('2d');
                superpositionChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timeAxis,
                        datasets: [
                        {
                            label: 'T√¢m Tr√≠ ƒê∆∞·ª£c R√®n Luy·ªán',
                            data: [],
                            borderColor: '#22c55e',
                            borderWidth: 3,
                            pointRadius: 0,
                            tension: 0.2,
                        },
                        {
                            label: 'T√¢m Tr√≠ Ph·∫£n ·ª®ng',
                            data: [],
                            borderColor: '#a855f7',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            tension: 0.2,
                        }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'D√≤ng th·ªùi gian' } },
                            y: { title: { display: true, text: 'C·∫£m x√∫c t·ªïng h·ª£p' }, suggestedMin: -10, suggestedMax: 10}
                        },
                        plugins: { legend: { position: 'top' } }
                    }
                });
            }

            function updateSuperpositionChart() {
                const trainedMindData = new Array(simLength).fill(0);
                const reactiveMindData = new Array(simLength).fill(0);

                const trainedParams = {
                    AG: parseFloat(sliders.ag.value),
                    SP: parseFloat(sliders.sp.value),
                    RM: parseFloat(sliders.rm.value)
                };
                const reactiveParams = { AG: 1.5, SP: 0.1, RM: 1 };

                events.forEach(event => {
                    for(let t = 0; t < simLength; t++){
                        const tau = t - event.time;
                        if(tau >= 0) {
                            trainedMindData[t] += Hn(tau, event.IAD0, trainedParams.AG, trainedParams.SP, trainedParams.RM);
                            reactiveMindData[t] += Hn(tau, event.IAD0, reactiveParams.AG, reactiveParams.SP, reactiveParams.RM);
                        }
                    }
                });
                
                superpositionChart.data.datasets[0].data = trainedMindData;
                superpositionChart.data.datasets[1].data = reactiveMindData;
                superpositionChart.update();
            }

            document.getElementById('addPositiveEvent').addEventListener('click', () => {
                events.push({time: Math.random()* (simLength-10), IAD0: 5 + Math.random() * 5 });
                updateSuperpositionChart();
            });

            document.getElementById('addNegativeEvent').addEventListener('click', () => {
                events.push({time: Math.random()* (simLength-10), IAD0: -5 - Math.random() * 5 });
                updateSuperpositionChart();
            });
            
            document.getElementById('resetSimulation').addEventListener('click', () => {
                events = [];
                updateSuperpositionChart();
            });
            
            createSuperpositionChart();
            updateSuperpositionChart();

            // Nav link active state on scroll
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 100) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            });
        });
    </script>
</body>
</html>

